* Сделать копию рабочей базы в отладочную.
* Обновить боевую базу до МД1 (Миграция справочников)
* Добавить перефирийнуб базу IB (только получатель = ложь) сделать выгрузку (сведения о пользователях не выгружать).
* Клон. Загрузить первоначальный образ в новую базу. Установить перфикс базы, аналогичный старой.
* Рабочая. Обновить боевую базу до МД2 (миграция документов).
* Рабочая. Удалить зарегистрированные документы для узла IB (не удалить миграцию МД). Иначе они попытаются выгрузиться все.
* Рабочая. Сделать выгрузку на переферийные базы.
* Клон. Сделать загрузку из ЦБ.
* Клон. Сделать выгрузку в ЦБ.
* Рабочая. Сделать загрузку из Клон.
* Рабочая. Пометить к выгрузке документы за период.
* Рабочая. Выгрузить данные. (Ориентировочно один год = 100 МБ (1Гб - распковано))

* Удалить всех пользователей из боевой базы. Оставить только администратора.
* В клон скопировать файл соответствий заказов (EDI)
* В клон скопировать настройки УРБД из ЦБ.
* Переименовать скприт запуска обмена с ЦБ (C:\Buhg\E\Exch\Scripts\ExchEk.bat)

Как создать новую периферийную файловую базу? 

- Загрузить через объединение МД
- Загрузить измененный МД
- Создать узел ИБ.

**Зарегистирировать документы к выгрузке за период:**
INSERT INTO _1SUPDTS  (DBSIGN, OBJID, TYPEID, DELETED, DWNLDID)
       (SELECT
			'IB' as DBSIGN,
			Жур.IDDoc as OBJID,
			Жур.IDDocDef as TYPEID,
			'' as DELETED,
			'' as DWNLDID
		FROM
			_1SJourn as Жур
		WHERE
			Жур.Date_Time_IDDoc BETWEEN :НачДата AND :КонДата~)


**Список данных к выгрузке в узел IB:**

	SELECT
		*
	FROM
		_1SUPDTS
	WHERE
		DBSIGN = 'IB'


**Документы реализации за период:**

	SELECT
		Жур.IDDoc as [Док $Документ],
		Жур.IDDocDef as Док_вид
	FROM
		_1SJourn as Жур
	WHERE
		Жур.Date_Time_IDDoc BETWEEN :НачДата AND :КонДата~ AND
		Жур.IDDocDef = $ВидДокумента.Реализация

**Вставка записей**
SELECT
	DBSIGN,
	TYPEID,
	OBJID,
		*
FROM
	_1SUPDTS
WHERE
	OBJID = :ВыбРеализация

SELECT
	'IB' as DBSIGN,
	Жур.IDDoc as OBJID,
	Жур.IDDocDef as TYPEID
FROM
	_1SJourn as Жур
WHERE
	Жур.IDDoc = :ВыбРеализация

*Нужно учесть что записи уже могут быть в таблице*
*Нужно проверить пометку удаления*

INSERT INTO _1SUPDTS  (DBSIGN, OBJID, TYPEID, DELETED, DWNLDID)
       (SELECT
			'IB' as DBSIGN,
			Жур.IDDoc as OBJID,
			Жур.IDDocDef as TYPEID,
			'' as DELETED,
			'' as DWNLDID
		FROM
			_1SJourn as Жур
		WHERE
			Жур.IDDoc = :ВыбРеализация)


##Материалы
[Эффективное использование MSSQL в 1С при помощи ВК 1С++](http://www.script-coding.com/Direct_queries.html)

